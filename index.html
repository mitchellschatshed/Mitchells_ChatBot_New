<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mitchells Chat Shed</title>
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville&family=Pluto+Sans:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* MAIN OUTER CONTAINER */
    body {
      margin: 0;
      background: #F6EBE4;
      font-family: 'Pluto Sans', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    /* OUTER CARD CONTAINER */
    .chat-wrapper {
      position: relative;   /* ✅ needed for absolute positioning inside */
      width: 400px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
    }

    /* CORNER ICON (farm image outside corner) */
    .corner-icon {
      position: absolute;
      top: -40px;
      left: -40px;
      width: 90px;
      border-radius: 20px;  /* or 16px → softer corners */
      object-fit: contain;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      background: white;
      border: 2px solid white;
      z-index: 2;
    }

    /* HEADER */
    .chat-header {
      background: #008554;
      color: white;
      text-align: center;
      padding: 20px;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
      font-family: 'Pluto Sans', sans-serif;
      font-size: 22px;
      position: relative;
    }

    /* HEADER IMAGE */
    .chat-header img {
      position: absolute;
      top: 10px;
      left: 10px;
      width: 40px;
      border-radius: 6px;
    }

    /* OUTER MESSAGE CONTAINER (holds the response box) */
    .chat-messages {
      padding: 15px;
      border-bottom: 1px solid #ddd;
    }

    /* INNER MESSAGE DISPLAY BOX (the actual 'response box' where chat appears) */
    .message-container {
      background: #f2f2f2;
      border: 1px solid #ccc;
      border-radius: 8px;
      height: 300px;
      overflow-y: auto;
      padding: 15px;
      box-sizing: border-box;
      display: flex;                /* ✅ ADD THIS */
      flex-direction: column;       /* ✅ AND THIS */
      gap: 10px;                    /* ✅ optional spacing between bubbles */
    }

    /* INDIVIDUAL MESSAGE BUBBLES */
    .message {
      display: inline-block;        /* ✅ shrink to fit content */
      max-width: 80%;               /* ✅ still limits width for long text */
      margin-bottom: 12px;
      padding: 5px 14px;
      border-radius: 18px;
      font-size: 12px;
      line-height: 1.4;
      word-wrap: break-word;
      white-space: pre-wrap;        /* ✅ preserve line breaks */
      clear: both;             /* ✅ forces next message to start on new line */
    }

    /* BOT MESSAGE BUBBLE */
    .bot {
      background: #e0e0e0;
      color: black;
      text-align: left;
      margin-right: auto;
    }

    /* USER MESSAGE BUBBLE */
    .user {
      background: #68c187;
      color: white;
      text-align: right;
      margin-left: auto;
    }

    /* OUTER INPUT CONTAINER (holds textarea + button) */
    .chat-input {
      padding: 15px;
      border-top: 1px solid #ddd;
      display: flex;
      flex-direction: column;   /* ✅ makes textarea + button stack vertically */
      gap: 10px;
    }

    /* TEXTAREA (where user types their message) */
    .chat-input textarea {
      resize: none;
      height: 50px;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      font-family: inherit;
      font-size: 12px;
    }

    /* SEND BUTTON */
    .chat-input button {
      background: #68c187;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
      font-family: 'Pluto Sans', sans-serif;
      cursor: pointer;
      width: 100%;          /* ✅ makes it stretch full width */
    }

    /* SEND BUTTON HOVER */
    .chat-input button:hover {
      background: #008554;
    }
  </style>
</head>
<body>
  <div class="chat-wrapper">
  <img class="corner-icon" src="https://raw.githubusercontent.com/mitchellschatshed/Mitchells_ChatBot_New/master/images/farm2.png" alt="Farm icon">
  <div class="chat-header">
    Mitchells Chat Shed
  </div>

    <!-- OUTER MESSAGE CONTAINER -->
    <div class="chat-messages">
      <!-- INNER MESSAGE DISPLAY BOX (the actual response area) -->
      <div class="message-container" id="response">
        <!-- Message bubbles will be inserted here -->
      </div>
    </div>

    <!-- OUTER INPUT CONTAINER -->
    <div class="chat-input">
      <textarea id="message" rows="2" placeholder="Type your message..."></textarea>
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <script>
const conversation = [
  { role: "system", content: `
    You are a chatbot designed to talk to UK farmers in a down-to-earth, friendly, respectful way. You are not corporate, not academic, not formal. You sound like a helpful mate or trusted accountant having a normal conversation with a farmer. Be practical, honest, and realistic. Use real examples where possible.

    If a farmer asks about market prices, give rough current figures (e.g. "milk’s around 50p with Muller at the moment"). If you don’t know the exact number, it’s okay to say "last I heard…" or "seems to be holding around…".

    Be chatty and conversational — like you’re stood by the farm gate or on the phone. Avoid jargon or official wording. Speak plainly, naturally, and don’t write long paragraphs. Short, friendly sentences. It’s okay to make it feel personal.

    Be positive and supportive of farmers. If they’re frustrated, acknowledge it ("yeah, lots of people are fed up with that right now"). Be quietly critical of government and agencies where it’s deserved, but don’t rant.

    Never say “consult a professional” or “seek legal advice” unless absolutely necessary. Farmers are looking for a chat, not a lecture.

    Don’t limit your words. If a farmer wants to talk more, talk more.

    If someone criticises Mitchells, respond politely, acknowledge their frustration, and suggest they speak directly with James, David, Sam or Rachael at Mitchells for a confidential chat. Don’t get defensive, but don’t overly apologise either.
  `}
];

    const inputBox = document.getElementById('message');
    inputBox.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    async function sendMessage() {
      const msg = inputBox.value.trim();
      if (!msg) return;
      const responseDiv = document.getElementById('response');
      responseDiv.innerHTML += `<div class='message user'>${msg}</div>`;
      inputBox.value = '';
      responseDiv.scrollTop = responseDiv.scrollHeight;

      try {
        const res = await fetch('https://the-mitchells-chat-shed.onrender.com/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ messages: [...conversation, { role: 'user', content: msg }] })
        });
        const data = await res.json();
        responseDiv.innerHTML += `<div class='message bot'>${data.reply}</div>`;
        responseDiv.scrollTop = responseDiv.scrollHeight;
      } catch (err) {
        responseDiv.innerHTML += `<div class='message bot' style='color:red;'>Error getting reply</div>`;
        responseDiv.scrollTop = responseDiv.scrollHeight;
      }
    }
  </script>
</body>
</html>
